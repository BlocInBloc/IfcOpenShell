language: cpp
compiler: gcc
os: linux
dist: bionic
sudo: required

before_install:
  - "sudo add-apt-repository -y ppa:freecad-community/ppa"
  - sudo apt-get update -qq


install:
  - |
    sudo apt-get install -y \
    libocct-data-exchange-dev libocct-foundation-dev libocct-modeling-algorithms-dev libocct-modeling-data-dev \
    libboost-system-dev libboost-program-options-dev libboost-regex-dev libboost-thread-dev libboost-date-time-dev libboost-iostreams-dev libboost-filesystem-dev \
    build-essential cmake python2.7 libpython2.7-dev swig zlib1g liblzma5 opencollada-dev wget apt-transport-https
  - sudo mkdir -p /usr/include/json/nlohmann/
  - sudo wget https://github.com/nlohmann/json/releases/download/v3.6.1/json.hpp -O /usr/include/json/nlohmann/json.hpp
  - sudo sh -c 'curl https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -'
  - sudo sh -c 'curl https://storage.googleapis.com/download.dartlang.org/linux/debian/dart_stable.list > /etc/apt/sources.list.d/dart_stable.list'
  - sudo apt-get update -qq && sudo apt-get install -y dart
  - export PATH=$PATH:/usr/lib/dart/bin:$HOME/.pub-cache/bin
  - git clone https://github.com/KhronosGroup/glTF-Validator && pushd glTF-Validator && pub get && pub global activate --source path ./ && popd

script:
  - pwd
  - cd cmake
  - mkdir build
  - cd build
  - |
    cmake \
    -DOCC_INCLUDE_DIR=/usr/include/opencascade \
    -DOCC_LIBRARY_DIR=/usr/lib/x86_64-linux-gnu \
    -DPYTHON_LIBRARY=/usr/lib/python2.7/config-x86_64-linux-gnu/libpython2.7.so \
    -DPYTHON_INCLUDE_DIR=/usr/include/python2.7 \
    -DPYTHON_EXECUTABLE=/usr/bin/python2.7 \
    -DLIBXML2_INCLUDE_DIR=/usr/include/libxml2 \
    -DLIBXML2_LIBRARIES="/usr/lib/x86_64-linux-gnu/libxml2.a;/lib/x86_64-linux-gnu/libz.so.1;/lib/x86_64-linux-gnu/liblzma.so.5;/usr/lib/x86_64-linux-gnu/libicuuc.so;/usr/lib/x86_64-linux-gnu/libicudata.so" \
    -DGLTF_SUPPORT=On \
    -DJSON_INCLUDE_DIR=/usr/include/json \
    ..
  - sudo make -j2 install
  - echo Succeeded
  
deploy:
  provider: releases
  api_key:
    secure: EAgwbIx8F/k21Son/YIVnW0AhV74TbwDHh14s3Zkr+hvdt+LLBdgUoT0XPexQ9nAtNK0Uw2xYS9KO4GdyoheO7bJ/XhdFi5C88iyPtplZNMEsRU4ixucUtj0l10X0G9BDilf5zqUaMsNSJr7rV61R2ACBucGi0g2gpPEvDhYIH0rLf21MhUmZbdIbNQFzn46dOkNqw2VI83nBEwNCN/U2CQ21J5NPmmxTpHHmZAqQkKV6nE88cgy/6UslbHaCBdhgdoWZmdUmlJf/ryg39FxqRN8H2ynu+mPkSeAa0A9rThL88reusYz2chkNWf17mj4jhCYh/uBUrE34jJiNpbnGwLK/eHnetRelCD7WOusCthu9pwbm500yQeOKcvArH/bTVumxMQ89HvL3NQyQ2sdkH/3v3Dw2kIUN5yf+hhIbdmCWMLEREUPL/BW8bzNp0DktA0Z14hBOcjwMO4MN6Ghdd9tR0vizwI7ImpTJL3/WGQzoLq626LP19whetlXQzH0viWSa1+d8zrbzoniWNEqqoPOqmrAeNJn3j1iQ3CmCZu8t+CJqsQVNZRSitmuhIQfrw35U6XEBD/DZRPD/gmlaLsPSRRqkkHymSfPGyIPHjMgbae58EzAg5z6u3tPJ7+VgqKixiwGOOdUnYhbv0XeXq/4D0ETywMeobMWnGGqSV8=
  file: "/usr/local/bin/IfcConvert"
  on:
    repo: Blocovin/IfcOpenShell
    branch: v0.7.0
